{% set order = hookable_metadata.context.resource %}
{% set payment = hookable_metadata.context.payment %}

{% set refund_link = path('sylius_admin_order_payment_refund', {'orderId': order.id, 'id': payment.id}) %}
{% if payment.method.gatewayConfig.factoryName == constant('Sylius\\MolliePlugin\\Payum\\Factory\\MollieGatewayFactory::FACTORY_NAME') %}
    {% set refund_link = path('sylius_mollie_admin_order_payment_refund', {'orderId': order.id, 'id': payment.id}) %}
{% endif %}

{% if sylius_sm_can(payment, constant('Sylius\\Component\\Payment\\PaymentTransitions::GRAPH'), constant('Sylius\\Component\\Payment\\PaymentTransitions::TRANSITION_REFUND')) %}
    <form action="{{ refund_link }}" method="POST" novalidate>
        <input type="hidden" name="_method" value="PUT">
        <input type="hidden" name="_csrf_token" value="{{ csrf_token(payment.id) }}" />
        <button type="submit" class="btn" {{ sylius_test_html_attribute('refund-payment', payment.id) }}>
            {{ ux_icon('tabler:arrow-back-up-double') }} {{ 'sylius.ui.refund'|trans }}
        </button>
    </form>
{% endif %}
